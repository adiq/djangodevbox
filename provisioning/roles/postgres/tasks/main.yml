---
- name: Postgres | Install Postgres Server
  apt: pkg=postgresql state=present

- name: Postgres | Install Postgres Client
  apt: pkg=postgresql-client state=present

- name: Postgres | Run Postgres
  service: name=postgresql state=started enabled=true

- name: Postgres | Install Python Postgres lib (psycopg2)
  pip: name=psycopg2

- name: Postgres | Setup database
  sudo_user: postgres
  postgresql_db:
    db: "{{ postgres.database }}"
    encoding: 'UTF-8'
    lc_collate: 'en_US.UTF-8'
    lc_ctype: 'en_US.UTF-8'
    template: 'template0'
    state: present

- name: Postgres | Setup database user
    sudo_user: postgres
    postgresql_user:
      db: "{{ postgres.database }}"
      user: "{{ postgres.user }}"
      password: "{{ postgres.password }}"
      role_attr_flags: "CREATEDB,SUPERUSER"
      state: present